# DeepSeek OCR GUI 打包说明

## 方法一：自动打包（推荐）

### 步骤

1. **运行打包脚本**
   ```bash
   python build_exe.py
   ```

2. **等待完成**
   - 脚本会自动检查并安装 PyInstaller
   - 打包过程需要 10-30 分钟
   - 完成后会在 `dist\DeepSeekOCR` 文件夹中生成可执行文件

3. **测试运行**
   ```bash
   dist\DeepSeekOCR\DeepSeekOCR.exe
   ```

## 方法二：手动打包

### 1. 安装 PyInstaller

```bash
pip install pyinstaller
```

### 2. 执行打包命令

```bash
pyinstaller --name=DeepSeekOCR ^
    --onedir ^
    --console ^
    --add-data "DeepSeek-OCR-master\DeepSeek-OCR-hf;DeepSeek-OCR-hf" ^
    --hidden-import=transformers ^
    --hidden-import=torch ^
    --hidden-import=PIL ^
    --hidden-import=einops ^
    --hidden-import=easydict ^
    --hidden-import=addict ^
    --hidden-import=tokenizers ^
    --hidden-import=safetensors ^
    --hidden-import=huggingface_hub ^
    DeepSeek-OCR-master\DeepSeek-OCR-hf\gui_ocr.py
```

### 3. 清理并重新打包（如果出错）

```bash
pyinstaller --clean DeepSeekOCR.spec
```

## 打包结果

### 文件结构
```
dist/
└── DeepSeekOCR/
    ├── DeepSeekOCR.exe        # 主程序
    ├── _internal/              # 依赖文件
    │   ├── python310.dll
    │   ├── torch库文件
    │   ├── transformers库文件
    │   └── 其他依赖...
    └── 其他必要文件
```

### 文件大小
- 预计总大小: 3-8 GB（包含完整的 PyTorch 和 Transformers）
- 如果需要更小的体积，可以考虑使用 CPU 版本的 PyTorch

## 分发说明

### 完整分发包
将整个 `dist\DeepSeekOCR` 文件夹打包成 zip，用户解压后即可使用。

### 创建安装程序（可选）
可以使用以下工具创建专业的安装程序：
- **Inno Setup** (免费)
- **NSIS** (免费)
- **Advanced Installer** (商业)

## 使用说明

### 系统要求
- Windows 10/11 (64位)
- 至少 16GB RAM（推荐）
- NVIDIA GPU（可选，但强烈推荐）
- 至少 10GB 可用磁盘空间

### 首次运行
1. 双击 `DeepSeekOCR.exe` 启动程序
2. 程序会自动下载模型（首次约 5-10 GB，需要网络）
3. 模型下载位置: `C:\Users\用户名\.cache\huggingface\`

### 离线使用
如果需要在无网络环境使用：
1. 在有网络的电脑上先运行一次，下载模型
2. 复制模型缓存目录到目标电脑的相同位置
3. 模型位置: `%USERPROFILE%\.cache\huggingface\hub\models--deepseek-ai--DeepSeek-OCR`

## 优化建议

### 减小体积
1. **使用 UPX 压缩**
   ```bash
   pyinstaller --upx-dir=C:\path\to\upx DeepSeekOCR.spec
   ```

2. **排除不需要的模块**
   在 spec 文件中添加 `excludes` 参数

3. **使用虚拟环境**
   在干净的虚拟环境中打包，只安装必要的依赖

### 提升性能
1. 确保打包时使用的是 GPU 版本的 PyTorch
2. 在 spec 文件中设置 `upx=True`
3. 考虑使用 `--onefile` 模式（但启动会稍慢）

## 常见问题

### Q1: 打包后运行报错 "找不到模块"
**A:** 在 spec 文件的 `hiddenimports` 中添加缺失的模块

### Q2: 打包后文件太大
**A:** 
- 确认使用的是 `--onedir` 模式
- 考虑移除不必要的依赖
- 使用 CPU 版本的 PyTorch（如果不需要 GPU）

### Q3: 模型下载失败
**A:**
- 检查网络连接
- 配置代理（如需要）
- 手动下载模型并放置到缓存目录

### Q4: 杀毒软件误报
**A:**
- 这是 PyInstaller 打包的常见问题
- 可以将 exe 添加到白名单
- 或使用代码签名证书签名

### Q5: 启动很慢
**A:**
- 这是正常现象，PyInstaller 需要解压依赖
- 首次运行后会更快
- 可以考虑使用 `--onefile` 但会更慢

## 创建桌面快捷方式

在 `dist\DeepSeekOCR` 文件夹中：
1. 右键点击 `DeepSeekOCR.exe`
2. 选择"发送到" → "桌面快捷方式"
3. 可以自定义快捷方式图标

## 创建启动器脚本

创建 `启动DeepSeekOCR.bat`:
```batch
@echo off
cd /d "%~dp0"
start "" "dist\DeepSeekOCR\DeepSeekOCR.exe"
```

## 高级打包选项

### 单文件模式
```bash
pyinstaller --onefile --name=DeepSeekOCR gui_ocr.py
```
- 优点: 只有一个 exe 文件
- 缺点: 启动慢，杀毒软件更容易误报

### 隐藏控制台窗口
在 spec 文件中设置 `console=False`
- 优点: 界面更清爽
- 缺点: 无法看到调试信息

### 添加图标
```bash
pyinstaller --icon=icon.ico gui_ocr.py
```

## 测试清单

打包完成后，请测试以下功能：
- [ ] 程序正常启动
- [ ] 模型能够加载
- [ ] 图像选择功能正常
- [ ] OCR识别功能正常
- [ ] 结果保存功能正常
- [ ] 日志显示正常
- [ ] 在另一台电脑上测试

## 技术支持

如遇到打包问题，请检查：
1. Python 版本是否为 3.8-3.11
2. 所有依赖是否正确安装
3. PyInstaller 版本是否最新
4. 查看打包过程中的警告信息
